namespace SpriteKind {
    export const Icono = SpriteKind.create()
    export const torre = SpriteKind.create()
}

function startSwarm() {
    
    swarm_left_to_spawn = swarmTotal
    swarm_left_to_destroy = swarmTotal
    elite_left_to_spawn = elite_total
    elite_left_to_destroy = elite_total
}

function hacer_torre(nombre: string, imagen: Image, coste: number): Sprite {
    
    torre_nueva = sprites.create(imagen, SpriteKind.torre)
    sprites.setDataString(torre_nueva, "nombre", nombre)
    sprites.setDataNumber(torre_nueva, "coste", coste)
    return torre_nueva
}

function dificultaddificil() {
    
    enemigo_velocidad = 30
    elite_velocidad = 35
    info.setLife(15)
    info.setScore(80)
    info.startCountdown(1)
}

function menu() {
    
    myMenu = miniMenu.createMenu(miniMenu.createMenuItem("Facil"), miniMenu.createMenuItem("Medio"), miniMenu.createMenuItem("Dificil"))
    myMenu.onButtonPressed(controller.A, function on_button_pressed(selection: any, selectedIndex: any) {
        if (selectedIndex == 0) {
            dificultadfacil()
        } else if (selectedIndex == 1) {
            dificultadmedia()
        } else if (selectedIndex == 2) {
            dificultaddificil()
        } else {
            
        }
        
        myMenu.close()
    })
}

spriteutils.createRenderable(5, function on_create_renderable(screen2: Image) {
    for (let value of sprites.allOfKind(SpriteKind.torre)) {
        if (sprites.readDataString(value, "nombre") == "arquero") {
            spriteutils.drawCircle(screen2, value.x, value.y, arquero_radio, 3)
        }
        
    }
    for (let value2 of list2) {
        screen2.drawLine(value2[0].x + randint(-1, 1), value2[0].y + randint(-1, 1), value2[1].x, value2[1].y, 5)
    }
})
function daño_electrical(sprite: Sprite, daño: number) {
    sprites.changeDataNumberBy(sprite, "vida", 0 - daño)
    if (sprites.readDataNumber(sprite, "vida") <= 0) {
        sprites.destroy(sprite)
        info.changeScoreBy(1)
    }
    
}

scene.onHitWall(SpriteKind.Enemy, function on_hit_wall(sprite2: Sprite, location: tiles.Location) {
    if (tiles.tileIs(tiles.locationOfSprite(sprite2), assets.tile`
            derecha
            `)) {
        sprite2.vy = 0
        sprite2.vx = enemigo_velocidad
    } else if (tiles.tileIs(tiles.locationOfSprite(sprite2), assets.tile`
            abajo1
            `)) {
        sprite2.vy = enemigo_velocidad
        sprite2.vx = 0
    } else if (tiles.tileIs(tiles.locationOfSprite(sprite2), assets.tile`
            izquierda0
            `)) {
        sprite2.vy = 0
        sprite2.vx = 0 - enemigo_velocidad
    } else if (tiles.tileIs(tiles.locationOfSprite(sprite2), assets.tile`
            arriba0
            `)) {
        sprite2.vy = 0 - enemigo_velocidad
        sprite2.vx = 0
    } else if (tiles.tileIs(tiles.locationOfSprite(sprite2), assets.tile`
            doblesentido
            `)) {
        sprite2.vy = 0
        sprite2.vx = enemigo_velocidad
        if (Math.percentChance(50)) {
            sprite2.vx = 0 - enemigo_velocidad
        }
        
    } else if (tiles.tileIs(tiles.locationOfSprite(sprite2), assets.tile`
            miMosaico0
            `)) {
        sprites.destroy(sprite2)
        info.changeLifeBy(-1)
    } else {
        
    }
    
})
controller.A.onEvent(ControllerButtonEvent.Pressed, function on_a_pressed() {
    
    if (!cosa_que_sujetamos) {
        if (cursor.overlapsWith(icono_arquero)) {
            if (info.score() >= 20) {
                cosa_que_sujetamos = hacer_torre("arquero", img`
                        . . . . . . f f . . . .
                        . . . . f f 9 9 f . . .
                        . . . f 9 9 9 9 9 f . .
                        . . . f 9 9 9 9 9 9 f .
                        . . f 9 9 9 9 9 9 9 f .
                        . f 9 9 9 9 9 9 9 9 9 f
                        . f f f 1 f 1 f 1 f f .
                        . . . . 1 f 1 f 1 . . .
                        . . . . 1 1 3 1 1 . . .
                        . . . . e e e e e . . .
                        . . . . e e e e e . . .
                        . . . . e e e e e . . .
                        . . . . e e e e e . . .
                        . . . . e e e e e . . .
                        . . . . e e e e e . . .
                        . . . . e e e e e . . .
                        `, 10)
                cursor.setFlag(SpriteFlag.Invisible, true)
                info.changeScoreBy(-20)
            }
            
        } else if (cursor.overlapsWith(icono_electric)) {
            if (info.score() >= 40) {
                cosa_que_sujetamos = hacer_torre("electric", img`
                        . . . . . . f f . . . .
                        . . . . f f 7 7 f . . .
                        . . . f 7 7 7 7 7 f . .
                        . . . f 7 7 7 7 7 7 f .
                        . . f 7 7 7 7 7 7 7 f .
                        . f 7 7 7 7 7 7 7 7 7 f
                        . f f f 1 2 1 2 1 f f .
                        . . . . 1 2 1 2 1 . . .
                        . . . . 1 1 3 1 1 . . .
                        . . . . 9 9 9 9 9 . . .
                        . . . . 9 9 9 9 9 . . .
                        . . . . 9 9 9 9 9 . . .
                        . . . . 9 9 9 9 9 . . .
                        . . . . 9 9 9 9 9 . . .
                        . . . . 9 9 9 9 9 . . .
                        . . . . 9 9 9 9 9 . . .
                        `, 10)
                cursor.setFlag(SpriteFlag.Invisible, true)
                info.changeScoreBy(-40)
            }
            
        } else {
            
        }
        
    } else {
        cosa_que_sujetamos = [][0]
        cursor.setFlag(SpriteFlag.Invisible, false)
    }
    
})
function dificultadfacil() {
    
    enemigo_velocidad = 15
    elite_velocidad = 20
    info.setLife(25)
    info.setScore(100)
    info.startCountdown(1)
}

info.onCountdownEnd(function on_countdown_end() {
    startSwarm()
})
function hacer_rayo(fuente: Sprite, daño2: number, golpe: Sprite[]) {
    if (daño2 > 0) {
        golpe.push(fuente)
        daño_electrical(fuente, daño2)
        for (let value3 of spriteutils.getSpritesWithin(SpriteKind.Enemy, 16, fuente)) {
            if (golpe.indexOf(value3) == -1) {
                hacer_rayo(value3, daño2 / 2, golpe)
                list2.push([fuente, value3])
            }
            
        }
    }
    
}

sprites.onDestroyed(SpriteKind.Enemy, function on_on_destroyed(sprite3: Sprite) {
    
    if (sprites.readDataBoolean(sprite3, "elite")) {
        elite_left_to_destroy += -1
    } else {
        swarm_left_to_destroy += -1
    }
    
    if (swarm_left_to_spawn == 0 && swarm_left_to_destroy == 0 && (elite_left_to_destroy == 0 && elite_left_to_spawn == 0)) {
        if (ronda_actual < ronda_maxima) {
            ronda_actual += 1
            swarmTotal += 5
            elite_total += 2
            info.startCountdown(1)
        } else {
            cursor.setFlag(SpriteFlag.Invisible, true)
            icono_arquero.setFlag(SpriteFlag.Invisible, true)
            icono_electric.setFlag(SpriteFlag.Invisible, true)
            game.splash("Ha amanecido! Han sobrevivido:" + ("" + ("" + info.life())))
            game.over(true)
        }
        
    }
    
})
function dificultadmedia() {
    
    enemigo_velocidad = 20
    elite_velocidad = 25
    info.setLife(20)
    info.setScore(90)
    info.startCountdown(1)
}

sprites.onOverlap(SpriteKind.Projectile, SpriteKind.Enemy, function on_on_overlap(sprite4: Sprite, otherSprite: Sprite) {
    sprites.destroy(sprite4)
    daño_electrical(otherSprite, 1)
})
let projectile : Sprite = null
let nuevo_enemigo : Sprite = null
let target : Sprite = null
let cosa_que_sujetamos : Sprite = null
let myMenu : miniMenu.MenuSprite = null
let elite_velocidad = 0
let enemigo_velocidad = 0
let torre_nueva : Sprite = null
let elite_left_to_destroy = 0
let elite_total = 0
let elite_left_to_spawn = 0
let swarm_left_to_destroy = 0
let swarm_left_to_spawn = 0
let ronda_maxima = 0
let ronda_actual = 0
let list2 : Sprite[][] = []
let icono_electric : Sprite = null
let icono_arquero : Sprite = null
let cursor : Sprite = null
let swarmTotal = 0
let arquero_radio = 0
scene.setBackgroundImage(img`
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666661ddd6666666666666666666666666666666666666666666
    666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666d111111111116666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666611111111111111166666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666dd1111111111111111111666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666d11111111111111111111111111666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666d11111111111111111111111111111116666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666d111111111111111111111111111111111111111111d6666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666111111111111111111111111111111111111111111111111111ddd666666666666666
    66666666666666666666666666666666666666666666666666666666666666666666666666666666666666611111111111111111111111111111111111111111d1111111111111111dddddd66666dddd
    66666666666666666666666666666666666666666666666666666666666666666666666666666666666111111dddd11111111111111111111111111111111111111111111dd1111111ddddddddddddd1
    6666666666666666666666666666666666666666666666666666666666666666666666666666666dd111111ddd111111111111111111111111111d11111111dd111dd11111111111111111111dddd111
    666666666666666666666666666666666666666666666666666666666666666666666666111111111111111111111111111111111111111d111d1111ddddddddd111111111ddddd111ddddddddd11111
    66666666666666666666666666666666666666666666666666666666666666666666911111111111111d1111111111dddddd11111dddd1ddddddddddddddddddddd1111dd111111111ddddddd1111111
    666666611111d66666666666666666666666666666666666666666666d1111111111d111d11111111111111111111111dddd1111dddddddddddddddddddddddddd111111111111dddddddddd11111111
    66666111111111166666666666666666666666666666666dd1111dddd11111111111ddddd11111111111111111111111111111ddddddddddddddddddddddddddd111111dddddddddddddddd11111111b
    666111111111111111666666666666666666666dd111111d11111ddddddddddddddddddddddddddddddddddddd11111111111ddddddddddddddddddddddddddddd11ddddddddddddddddd11111bbbbbb
    1ddd1dd11111ddd1111111666666666dd11111111111111dddddddddddd11111111ddddddddddddddddddddddddddd1111111dddddddddddddddddddddddddddddddddddddddddddddd11111bbbbbbbb
    ddddddddd11dddddd11111111111dd1111111111dddddddddddddd1111111111111111ddddddddddddddddddddddddddd111111ddddddddddddddddddddddddddddddddddddddddddbbb1bbbbbbbbbbb
    dddddddddddddddddddddd1111111d1dddddddddddddddddd1111111111111111111111111dddddddddddddddddddddddddd11111111ddddddddddddddddddddddddddddddddddbbbbbbbbbbbbbbbbbb
    111111ddddddddddddddddddddddddddddddddddddddb111111111111111111111111111111111dddddddddddddddddddddddddd111111dddddddddddddddddddddddddddddbbbbbbbbbbbbbbbbbbbbb
    1111111111dddddddddddddddddddddddddddddddb111111111111111111111111111111111b1111ddddddddddddddddddddddddddddd1ddddddddddddddddddddddddddbbbbbbbbbbbbbbbbbbbbb11b
    1111111111111dddddddddddddddddddddddddb1111111111111111111111bbb11111111111111111111ddddddddddddddddddddddddddddddddddddddddddddddddbbbbbbbbbbbbbbbbbbbbb1111111
    1111111bbb111111ddddddddddddddddddddbb1111111111111111bbbbbb111bb111111111111111111111bbbddddddddddddddddddddddddddddddddddddddddbbbbbbbbbbbbbbbbbb1111111111111
    bbbb111bbbbbb11111ddddddddddddddbbb11111111b111bbb11bbbbbbbbb1bbbbbbbbb1111bb1111b111111111bbddddddddddddddddddddddddddddddddbbbbbbbbbbbbbbbbbbbb111111111111111
    bbbbbbbbbbbbbbbb1111bddddddbbbbbbbb1111bbb111bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb1111b1111111bbbbbbbbdddddddddddddddddddddddbbbbbbbbbbbbbbbbbbbbb11111111111111111
    bbbbbbbbbbbbbbbbbb1bbbbbbbbbbbbbbbbbbbbbbb11bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb11bbbbbbbbbbbbbbbbbbbbbbdddddddbbbbbbbbbbbbbbbbbbbbbbbbbbbbc1111111111111111111
    bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbcc1111111111111111111c11
    bbbbbbbb1b11bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbcccc11111111111111111111111111
    bbbbb11111111111b11bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbccccc11111111111c11111111111111111111
    bbb11111111111111111bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb11111111111bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbccccccccc11111111111c11111c111111cc11c11111c
    bb1111111111111111111111bbbbbbbbbbbbbbbbbbbbbbbbbb111111111111111bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb111111ccccccccccc1111c111c11111111c1111cccc11cc11111c
    bb11111111111111111111111111bb1bbbbbbbbbbbbbbbcc1111111111111111111bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb111111111111ccccccccccccc11111111c111c1111cccc11cc111111c
    b11111c1111111111111111111111c1111111bbbc111111111111111111111cc111111cbbbbbbbbbbbbbbbbbbbbbbbbb111111111111111111cc1ccccccccc11111cccccc111111ccccc11ccc11111cc
    b1111ccc1111111111111111111111cc111111ccccccccc111111111111111ccccccc11111cbbbbbbbbbbbbbbbbbbbbc111111cc11111111ccccccccccccccc1cccccccc11c111ccccc111cc11111ccc
    1111dccc111111111111111111111111cccc11cccccccccc11111cccccccccccccccccc111111cccccbbbbbbcccccccccccccc111111ccccccccccccccccccccccccccc111111ccccccc1ccc11111ccc
    1cccc1111111111111111111c111111111cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc1111cccccccccccccccccccc
    cccc11111111111111111111111111111111ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc1cccccccccccccccccccccc
    ccc111111111111111111111111111111c111ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
    11c11111c11111c1c1111cc1111111c111c11111cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
    1111111ccc111cc1cc111cc111111111111cc111111ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
    111c11ccc1111cc1cc11ccccc111ccc11111cccc1111cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
    11cccccccc11cc11cc11cccccc111ccccc11cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
    ccccccccccccccc1ccc11ccccccc11cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
    ccccccccccccccc1cccc1cccccccc11ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
    cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
    cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
    cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
    cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
    ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc6cccccccccccccccccccc
    cccccccccccccccccccccccccc66cccccccccccccccc6ccccccccccccccccccccccccccccccccccccccccccc666c6cccccccccccc66666ccccccccccccccccc6ccccccc6ccc66ccccc6ccccccccccccc
    6cc6c6666c6c6666c666cc66c666666666666666c666666cccc6666c66666666666666666666666cc6666666666666666666666666666666666666666666666666666cc666666666666666666666c666
    666666666666666666666666e6666666666666666666ee6666666666666666666666666666666666666666eeeee6ee66666666666eeeee66666e66e66ee6666666e666e66666666eeee6666e66666666
    6666e66e6e6ee666e66666666666666666ee6666666eee6666666eeee66eee66eee66666eee66eee666666ee66ee66eeeee76eeee6e66ee66666666eeee66e66666666e666666666eeeee6666ee66666
    666e666666666666666e666666666666668888888888888888888888888888888888888888888888888888888888888888886ee666e66ee66666666eee666eeee6eee66666666666ee6e666ee6666666
    6666666e66666eee66666666688888888888888888888888888888888888888888888888888888888888888888888888888888868888888888888888888888888888868888888e6666666666666e666e
    66666666666666e66666666e88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888866666e666666666e
    66666666666666666ee66668888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888886666e66666e66e
    66666666666e6666666666e8888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888e66666e666666
    6666e66ee666666ee6e88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888866666666e666
    666666666666ee8888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888868888666666e
    66e6666666e88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888666666
    6e6666e668888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888866666
    6e666e668888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888866e
    66666e8888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888666
    6666688888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888666
    6666688888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888666
    66e6888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888666
    ee66888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888e66
    666e888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888666
    66666888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888668e66ee
    ee66888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888866666e66
    e6666888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888666ee666
    e666866888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888688888886886666666666
    666e66688888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888868888886667666666e666
    6666668868886888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888666866e666666eee66666
    66e666e666886888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888666666666ee666e666666666
    66e6666666866888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888886666666666666666666666666
    6666666666e66688888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888886866eee666666e66666666666666
    e66666e66666668888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888686e666e6666e666e66666666666
    ee66666666666688888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888866666666ee666e666e66666666666
    666666666666666688888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888886686ee666e6666e666e6666e6e66e
    6666666666e66666888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888886666e666eee6666666e6e6666666
    6666666666e6666888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888886e66666eee66ee6666666e6666666
    e66e66666e66688888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888666666666eee6666eee666666
    e66666e6666668888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888e66666666ee666ee6666
    66666e666688888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888666666e666666666
    666e66688888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888e66666e
    e6e6668888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888666
    6666688888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888886
    6888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
    8888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
    8888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
    8888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
    8888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
    8888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
    8888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
    8888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
    8888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
    8888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
    8888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
    8888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
    8888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
    8888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
    8888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
    8888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
    8888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
    8888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
    8888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
    8888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
    8888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
    8888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
    8888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
    8888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
    ee88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
    `)
game.splash("La aldea La Casona del Olivar tiene una maldición.")
game.splash("Por la noche aparecen monstruos...")
game.splash("Quieren entrar en la casa de la gente para comerselos.")
game.splash("pero hay algunos aldeanos dispuestos a defender su hogar")
menu()
scene.setBackgroundImage(img`
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    `)
tiles.loadMap(tiles.createSmallMap(tilemap`
    map
    `))
tiles.coverAllTiles(assets.tile`
        abajo1
        `, assets.tile`
        myTile2
        `)
tiles.coverAllTiles(assets.tile`
        izquierda0
        `, assets.tile`
        myTile2
        `)
tiles.coverAllTiles(assets.tile`
        arriba0
        `, assets.tile`
        myTile2
        `)
tiles.coverAllTiles(assets.tile`
        derecha
        `, assets.tile`
        myTile2
        `)
tiles.coverAllTiles(assets.tile`
        doblesentido
        `, assets.tile`
        myTile2
        `)
swarmTotal = 10
arquero_radio = 24
cursor = sprites.create(img`
        . . . . . . . . . f . .
        . . . . . . . . f 1 f .
        . . . . . . . . f 1 f .
        . . . . . . . . f 1 f .
        . f . f . f . f f 1 f .
        f 1 f 1 f 1 f 1 1 1 f .
        f 1 1 1 1 1 1 1 1 1 1 f
        f 1 1 1 1 1 1 1 1 1 1 f
        f 1 1 1 1 1 1 1 1 1 1 f
        f 1 1 1 1 1 1 1 1 1 1 f
        . f 1 1 1 1 1 1 1 1 f .
        . . f f f f f f f f . .
        `, SpriteKind.Player)
controller.moveSprite(cursor, 70, 70)
cursor.setFlag(SpriteFlag.GhostThroughWalls, true)
icono_arquero = sprites.create(img`
        . 6 6 6 6 6 6 .
        6 9 9 9 9 9 9 6
        6 9 6 6 6 6 9 6
        6 6 6 6 6 6 6 6
        6 9 f 1 1 f 9 6
        6 9 1 3 3 1 9 6
        6 9 9 9 9 9 9 6
        . 6 6 6 6 6 6 .
        `, SpriteKind.Icono)
icono_arquero.top = 2
icono_arquero.left = 110
icono_electric = sprites.create(img`
        . 7 7 7 7 7 7 .
        7 6 6 6 6 6 6 7
        7 6 7 7 7 7 6 7
        7 7 7 7 7 7 7 7
        7 6 2 1 1 2 6 7
        7 6 1 3 3 1 6 7
        7 6 6 6 6 6 6 7
        . 7 7 7 7 7 7 .
        `, SpriteKind.Icono)
icono_electric.top = 2
icono_electric.left = 130
list2 = []
ronda_actual = 1
ronda_maxima = 5
game.onUpdate(function on_on_update() {
    if (cosa_que_sujetamos) {
        cosa_que_sujetamos.setPosition(cursor.x, cursor.y)
    }
    
})
game.onUpdateInterval(2000, function on_update_interval() {
    
    for (let value4 of sprites.allOfKind(SpriteKind.torre)) {
        if (sprites.readDataString(value4, "nombre") == "electric" && value4 != cosa_que_sujetamos) {
            target = spriteutils.getSpritesWithin(SpriteKind.Enemy, arquero_radio, value4)._pickRandom()
            if (target) {
                hacer_rayo(target, 100, [])
            }
            
        }
        
    }
    timer.after(500, function on_after() {
        
        list2 = []
    })
})
game.onUpdateInterval(1000, function on_update_interval2() {
    let velocidad_elite: number;
    
    if (swarm_left_to_spawn > 0) {
        swarm_left_to_spawn += -1
        nuevo_enemigo = sprites.create(img`
                c c c c c c c c
                c c 1 c c c 1 c
                c c c c c c c c
                c c c c c c c c
                c 1 1 c c c c c
                c c 1 1 c c c c
                c c c 1 1 1 c c
                c c c c c c c c
                `, SpriteKind.Enemy)
        tiles.placeOnRandomTile(nuevo_enemigo, assets.tile`
            myTile
            `)
        nuevo_enemigo.vy = enemigo_velocidad
        sprites.setDataNumber(nuevo_enemigo, "vida", 4)
    } else if (elite_left_to_spawn > 0) {
        velocidad_elite = 0
        elite_left_to_spawn += -1
        nuevo_enemigo = sprites.create(img`
                2 2 2 2 2 2 2 2
                2 2 9 2 2 2 9 2
                2 2 2 2 2 2 2 2
                2 2 2 2 2 2 2 2
                2 9 9 2 2 2 2 2
                2 2 9 9 2 2 2 2
                2 2 2 9 9 9 2 2
                2 2 2 2 2 2 2 2
                `, SpriteKind.Enemy)
        tiles.placeOnRandomTile(nuevo_enemigo, assets.tile`
            myTile
            `)
        nuevo_enemigo.vy = elite_velocidad
        sprites.setDataNumber(nuevo_enemigo, "vida", 8)
        sprites.setDataBoolean(nuevo_enemigo, "elite", true)
    } else {
        
    }
    
})
game.onUpdateInterval(500, function on_update_interval3() {
    
    for (let value5 of sprites.allOfKind(SpriteKind.torre)) {
        if (sprites.readDataString(value5, "nombre") == "arquero" && value5 != cosa_que_sujetamos) {
            target = spriteutils.getSpritesWithin(SpriteKind.Enemy, arquero_radio, value5)._pickRandom()
            if (target) {
                projectile = sprites.createProjectileFromSprite(img`
                    4 4
                    4 4
                    `, value5, 0, 0)
                spriteutils.setVelocityAtAngle(projectile, spriteutils.angleFrom(value5, target), 100)
                projectile.setFlag(SpriteFlag.GhostThroughWalls, true)
            }
            
        }
        
    }
})
